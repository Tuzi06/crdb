{"ast":null,"code":"var _jsxFileName = \"/Users/damienwang/Documents/code/crdb/src/App.js\",\n  _s = $RefreshSig$();\nimport { jsxDEV as _jsxDEV, Fragment as _Fragment } from \"react/jsx-dev-runtime\";\nconst {\n  useState,\n  useEffect\n} = React;\nconst {\n  mongoose\n} = mongoose;\n\n// 后端 API 地址\nconst API_URL = 'https://crbd-backend.vercel.app/api/companies';\nconst allIndustries = [\"全部\", \"互联网\", \"金融\", \"物流\", \"教育\", \"设计\", \"制造\", \"其他\"];\nfunction App() {\n  _s();\n  const [companies, setCompanies] = useState([]);\n  const [loading, setLoading] = useState(true); // 新增加载状态\n  const [filterIndustry, setFilterIndustry] = useState(\"全部\");\n  const [isModalOpen, setIsModalOpen] = useState(false);\n  const [toast, setToast] = useState({\n    show: false,\n    message: ''\n  });\n  const [formData, setFormData] = useState({\n    name: '',\n    industry: '互联网',\n    type: 'red',\n    rating: 5,\n    tags: '',\n    comment: ''\n  });\n\n  // 1. 从后端获取数据\n  const fetchCompanies = async () => {\n    try {\n      setLoading(true);\n      // 根据当前筛选的行业构建 URL 参数\n      const url = filterIndustry === \"全部\" ? API_URL : `${API_URL}?industry=${filterIndustry}`;\n      const response = await fetch(url);\n      const data = await response.json();\n      setCompanies(data);\n    } catch (error) {\n      console.error(\"获取数据失败:\", error);\n      setToast({\n        show: true,\n        message: \"连接服务器失败\",\n        isSuccess: false\n      });\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  // 初始化加载和筛选变化时重新获取\n  useEffect(() => {\n    fetchCompanies();\n  }, [filterIndustry]);\n  const toggleModal = () => {\n    setIsModalOpen(!isModalOpen);\n    if (!isModalOpen) {\n      setFormData({\n        name: '',\n        industry: '互联网',\n        type: 'red',\n        rating: 5,\n        tags: '',\n        comment: ''\n      });\n    }\n  };\n  const handleInputChange = e => {\n    const {\n      name,\n      value\n    } = e.target;\n    setFormData(prev => ({\n      ...prev,\n      [name]: value\n    }));\n  };\n\n  // 2. 提交数据到后端\n  const handleSubmit = async e => {\n    e.preventDefault();\n    if (!formData.name || !formData.comment) return;\n    const payload = {\n      ...formData,\n      tags: formData.tags.split(/[,，]/).map(tag => tag.trim()).filter(tag => tag),\n      rating: parseFloat(formData.rating)\n    };\n    try {\n      const response = await fetch(API_URL, {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json'\n        },\n        body: JSON.stringify(payload)\n      });\n      if (response.ok) {\n        const newCompany = await response.json();\n        // 成功后，将新数据加到列表最前面，避免重新请求整个列表（优化体验）\n        setCompanies([newCompany, ...companies]);\n        toggleModal();\n        setToast({\n          show: true,\n          message: \"发布成功！\",\n          isSuccess: true\n        });\n      } else {\n        throw new Error(\"提交失败\");\n      }\n    } catch (error) {\n      console.error(error);\n      setToast({\n        show: true,\n        message: \"发布失败，请重试\",\n        isSuccess: false\n      });\n    }\n  };\n  const showToast = (message, isSuccess = true) => {\n    setToast({\n      show: true,\n      message,\n      isSuccess\n    });\n    setTimeout(() => setToast(prev => ({\n      ...prev,\n      show: false\n    })), 3000);\n  };\n  const redList = companies.filter(c => c.type === 'red');\n  const blackList = companies.filter(c => c.type === 'black');\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    children: [/*#__PURE__*/_jsxDEV(Header, {\n      filterIndustry: filterIndustry,\n      onFilterChange: e => setFilterIndustry(e.target.value),\n      onAddClick: toggleModal\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 100,\n      columnNumber: 11\n    }, this), /*#__PURE__*/_jsxDEV(\"main\", {\n      children: loading ? /*#__PURE__*/_jsxDEV(\"div\", {\n        style: {\n          textAlign: 'center',\n          padding: '2rem'\n        },\n        children: \"\\u52A0\\u8F7D\\u4E2D...\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 107,\n        columnNumber: 19\n      }, this) : /*#__PURE__*/_jsxDEV(_Fragment, {\n        children: [/*#__PURE__*/_jsxDEV(Section, {\n          title: \"\\u7EA2\\u699C (\\u63A8\\u8350)\",\n          type: \"red\",\n          data: redList,\n          icon: \"fa-heart\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 110,\n          columnNumber: 23\n        }, this), /*#__PURE__*/_jsxDEV(Section, {\n          title: \"\\u9ED1\\u699C (\\u907F\\u96F7)\",\n          type: \"black\",\n          data: blackList,\n          icon: \"fa-skull\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 111,\n          columnNumber: 23\n        }, this)]\n      }, void 0, true)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 105,\n      columnNumber: 11\n    }, this), /*#__PURE__*/_jsxDEV(Modal, {\n      isOpen: isModalOpen,\n      onClose: toggleModal,\n      formData: formData,\n      onChange: handleInputChange,\n      onSubmit: handleSubmit\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 115,\n      columnNumber: 11\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      className: `toast ${toast.show ? 'show' : ''}`,\n      style: {\n        backgroundColor: toast.isSuccess ? '#10b981' : '#ef4444'\n      },\n      children: toast.message\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 116,\n      columnNumber: 11\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 99,\n    columnNumber: 7\n  }, this);\n}\n_s(App, \"Y5eVc7PTWSdUWMGEHbJ6XcR9Otk=\");\n_c = App;\nexport default App;\nvar _c;\n$RefreshReg$(_c, \"App\");","map":{"version":3,"names":["useState","useEffect","React","mongoose","API_URL","allIndustries","App","_s","companies","setCompanies","loading","setLoading","filterIndustry","setFilterIndustry","isModalOpen","setIsModalOpen","toast","setToast","show","message","formData","setFormData","name","industry","type","rating","tags","comment","fetchCompanies","url","response","fetch","data","json","error","console","isSuccess","toggleModal","handleInputChange","e","value","target","prev","handleSubmit","preventDefault","payload","split","map","tag","trim","filter","parseFloat","method","headers","body","JSON","stringify","ok","newCompany","Error","showToast","setTimeout","redList","c","blackList","_jsxDEV","children","Header","onFilterChange","onAddClick","fileName","_jsxFileName","lineNumber","columnNumber","style","textAlign","padding","_Fragment","Section","title","icon","Modal","isOpen","onClose","onChange","onSubmit","className","backgroundColor","_c","$RefreshReg$"],"sources":["/Users/damienwang/Documents/code/crdb/src/App.js"],"sourcesContent":["const { useState, useEffect } = React;\nconst {mongoose} = mongoose;\n\n// 后端 API 地址\nconst API_URL = 'https://crbd-backend.vercel.app/api/companies';\n\nconst allIndustries = [\"全部\", \"互联网\", \"金融\", \"物流\", \"教育\", \"设计\", \"制造\", \"其他\"];\n\nfunction App() {\n  const [companies, setCompanies] = useState([]);\n  const [loading, setLoading] = useState(true); // 新增加载状态\n  const [filterIndustry, setFilterIndustry] = useState(\"全部\");\n  const [isModalOpen, setIsModalOpen] = useState(false);\n  const [toast, setToast] = useState({ show: false, message: '' });\n\n  const [formData, setFormData] = useState({\n      name: '', industry: '互联网', type: 'red', rating: 5, tags: '', comment: ''\n  });\n\n  // 1. 从后端获取数据\n  const fetchCompanies = async () => {\n      try {\n          setLoading(true);\n          // 根据当前筛选的行业构建 URL 参数\n          const url = filterIndustry === \"全部\" \n              ? API_URL \n              : `${API_URL}?industry=${filterIndustry}`;\n          \n          const response = await fetch(url);\n          const data = await response.json();\n          setCompanies(data);\n      } catch (error) {\n          console.error(\"获取数据失败:\", error);\n          setToast({ show: true, message: \"连接服务器失败\", isSuccess: false });\n      } finally {\n          setLoading(false);\n      }\n  };\n\n  // 初始化加载和筛选变化时重新获取\n  useEffect(() => {\n      fetchCompanies();\n  }, [filterIndustry]);\n\n  const toggleModal = () => {\n      setIsModalOpen(!isModalOpen);\n      if (!isModalOpen) {\n          setFormData({ name: '', industry: '互联网', type: 'red', rating: 5, tags: '', comment: '' });\n      }\n  };\n\n  const handleInputChange = (e) => {\n      const { name, value } = e.target;\n      setFormData(prev => ({ ...prev, [name]: value }));\n  };\n\n  // 2. 提交数据到后端\n  const handleSubmit = async (e) => {\n      e.preventDefault();\n      if (!formData.name || !formData.comment) return;\n\n      const payload = {\n          ...formData,\n          tags: formData.tags.split(/[,，]/).map(tag => tag.trim()).filter(tag => tag),\n          rating: parseFloat(formData.rating)\n      };\n\n      try {\n          const response = await fetch(API_URL, {\n              method: 'POST',\n              headers: { 'Content-Type': 'application/json' },\n              body: JSON.stringify(payload)\n          });\n\n          if (response.ok) {\n              const newCompany = await response.json();\n              // 成功后，将新数据加到列表最前面，避免重新请求整个列表（优化体验）\n              setCompanies([newCompany, ...companies]);\n              toggleModal();\n              setToast({ show: true, message: \"发布成功！\", isSuccess: true });\n          } else {\n              throw new Error(\"提交失败\");\n          }\n      } catch (error) {\n          console.error(error);\n          setToast({ show: true, message: \"发布失败，请重试\", isSuccess: false });\n      }\n  };\n\n  const showToast = (message, isSuccess = true) => {\n      setToast({ show: true, message, isSuccess });\n      setTimeout(() => setToast(prev => ({ ...prev, show: false })), 3000);\n  };\n\n  const redList = companies.filter(c => c.type === 'red');\n  const blackList = companies.filter(c => c.type === 'black');\n\n  return (\n      <div>\n          <Header \n              filterIndustry={filterIndustry} \n              onFilterChange={(e) => setFilterIndustry(e.target.value)}\n              onAddClick={toggleModal}\n          />\n          <main>\n              {loading ? (\n                  <div style={{textAlign: 'center', padding: '2rem'}}>加载中...</div>\n              ) : (\n                  <>\n                      <Section title=\"红榜 (推荐)\" type=\"red\" data={redList} icon=\"fa-heart\" />\n                      <Section title=\"黑榜 (避雷)\" type=\"black\" data={blackList} icon=\"fa-skull\" />\n                  </>\n              )}\n          </main>\n          <Modal isOpen={isModalOpen} onClose={toggleModal} formData={formData} onChange={handleInputChange} onSubmit={handleSubmit} />\n          <div className={`toast ${toast.show ? 'show' : ''}`} style={{ backgroundColor: toast.isSuccess ? '#10b981' : '#ef4444' }}>\n              {toast.message}\n          </div>\n      </div>\n  );\n}\n\nexport default App;\n"],"mappings":";;;AAAA,MAAM;EAAEA,QAAQ;EAAEC;AAAU,CAAC,GAAGC,KAAK;AACrC,MAAM;EAACC;AAAQ,CAAC,GAAGA,QAAQ;;AAE3B;AACA,MAAMC,OAAO,GAAG,+CAA+C;AAE/D,MAAMC,aAAa,GAAG,CAAC,IAAI,EAAE,KAAK,EAAE,IAAI,EAAE,IAAI,EAAE,IAAI,EAAE,IAAI,EAAE,IAAI,EAAE,IAAI,CAAC;AAEvE,SAASC,GAAGA,CAAA,EAAG;EAAAC,EAAA;EACb,MAAM,CAACC,SAAS,EAAEC,YAAY,CAAC,GAAGT,QAAQ,CAAC,EAAE,CAAC;EAC9C,MAAM,CAACU,OAAO,EAAEC,UAAU,CAAC,GAAGX,QAAQ,CAAC,IAAI,CAAC,CAAC,CAAC;EAC9C,MAAM,CAACY,cAAc,EAAEC,iBAAiB,CAAC,GAAGb,QAAQ,CAAC,IAAI,CAAC;EAC1D,MAAM,CAACc,WAAW,EAAEC,cAAc,CAAC,GAAGf,QAAQ,CAAC,KAAK,CAAC;EACrD,MAAM,CAACgB,KAAK,EAAEC,QAAQ,CAAC,GAAGjB,QAAQ,CAAC;IAAEkB,IAAI,EAAE,KAAK;IAAEC,OAAO,EAAE;EAAG,CAAC,CAAC;EAEhE,MAAM,CAACC,QAAQ,EAAEC,WAAW,CAAC,GAAGrB,QAAQ,CAAC;IACrCsB,IAAI,EAAE,EAAE;IAAEC,QAAQ,EAAE,KAAK;IAAEC,IAAI,EAAE,KAAK;IAAEC,MAAM,EAAE,CAAC;IAAEC,IAAI,EAAE,EAAE;IAAEC,OAAO,EAAE;EAC1E,CAAC,CAAC;;EAEF;EACA,MAAMC,cAAc,GAAG,MAAAA,CAAA,KAAY;IAC/B,IAAI;MACAjB,UAAU,CAAC,IAAI,CAAC;MAChB;MACA,MAAMkB,GAAG,GAAGjB,cAAc,KAAK,IAAI,GAC7BR,OAAO,GACP,GAAGA,OAAO,aAAaQ,cAAc,EAAE;MAE7C,MAAMkB,QAAQ,GAAG,MAAMC,KAAK,CAACF,GAAG,CAAC;MACjC,MAAMG,IAAI,GAAG,MAAMF,QAAQ,CAACG,IAAI,CAAC,CAAC;MAClCxB,YAAY,CAACuB,IAAI,CAAC;IACtB,CAAC,CAAC,OAAOE,KAAK,EAAE;MACZC,OAAO,CAACD,KAAK,CAAC,SAAS,EAAEA,KAAK,CAAC;MAC/BjB,QAAQ,CAAC;QAAEC,IAAI,EAAE,IAAI;QAAEC,OAAO,EAAE,SAAS;QAAEiB,SAAS,EAAE;MAAM,CAAC,CAAC;IAClE,CAAC,SAAS;MACNzB,UAAU,CAAC,KAAK,CAAC;IACrB;EACJ,CAAC;;EAED;EACAV,SAAS,CAAC,MAAM;IACZ2B,cAAc,CAAC,CAAC;EACpB,CAAC,EAAE,CAAChB,cAAc,CAAC,CAAC;EAEpB,MAAMyB,WAAW,GAAGA,CAAA,KAAM;IACtBtB,cAAc,CAAC,CAACD,WAAW,CAAC;IAC5B,IAAI,CAACA,WAAW,EAAE;MACdO,WAAW,CAAC;QAAEC,IAAI,EAAE,EAAE;QAAEC,QAAQ,EAAE,KAAK;QAAEC,IAAI,EAAE,KAAK;QAAEC,MAAM,EAAE,CAAC;QAAEC,IAAI,EAAE,EAAE;QAAEC,OAAO,EAAE;MAAG,CAAC,CAAC;IAC7F;EACJ,CAAC;EAED,MAAMW,iBAAiB,GAAIC,CAAC,IAAK;IAC7B,MAAM;MAAEjB,IAAI;MAAEkB;IAAM,CAAC,GAAGD,CAAC,CAACE,MAAM;IAChCpB,WAAW,CAACqB,IAAI,KAAK;MAAE,GAAGA,IAAI;MAAE,CAACpB,IAAI,GAAGkB;IAAM,CAAC,CAAC,CAAC;EACrD,CAAC;;EAED;EACA,MAAMG,YAAY,GAAG,MAAOJ,CAAC,IAAK;IAC9BA,CAAC,CAACK,cAAc,CAAC,CAAC;IAClB,IAAI,CAACxB,QAAQ,CAACE,IAAI,IAAI,CAACF,QAAQ,CAACO,OAAO,EAAE;IAEzC,MAAMkB,OAAO,GAAG;MACZ,GAAGzB,QAAQ;MACXM,IAAI,EAAEN,QAAQ,CAACM,IAAI,CAACoB,KAAK,CAAC,MAAM,CAAC,CAACC,GAAG,CAACC,GAAG,IAAIA,GAAG,CAACC,IAAI,CAAC,CAAC,CAAC,CAACC,MAAM,CAACF,GAAG,IAAIA,GAAG,CAAC;MAC3EvB,MAAM,EAAE0B,UAAU,CAAC/B,QAAQ,CAACK,MAAM;IACtC,CAAC;IAED,IAAI;MACA,MAAMK,QAAQ,GAAG,MAAMC,KAAK,CAAC3B,OAAO,EAAE;QAClCgD,MAAM,EAAE,MAAM;QACdC,OAAO,EAAE;UAAE,cAAc,EAAE;QAAmB,CAAC;QAC/CC,IAAI,EAAEC,IAAI,CAACC,SAAS,CAACX,OAAO;MAChC,CAAC,CAAC;MAEF,IAAIf,QAAQ,CAAC2B,EAAE,EAAE;QACb,MAAMC,UAAU,GAAG,MAAM5B,QAAQ,CAACG,IAAI,CAAC,CAAC;QACxC;QACAxB,YAAY,CAAC,CAACiD,UAAU,EAAE,GAAGlD,SAAS,CAAC,CAAC;QACxC6B,WAAW,CAAC,CAAC;QACbpB,QAAQ,CAAC;UAAEC,IAAI,EAAE,IAAI;UAAEC,OAAO,EAAE,OAAO;UAAEiB,SAAS,EAAE;QAAK,CAAC,CAAC;MAC/D,CAAC,MAAM;QACH,MAAM,IAAIuB,KAAK,CAAC,MAAM,CAAC;MAC3B;IACJ,CAAC,CAAC,OAAOzB,KAAK,EAAE;MACZC,OAAO,CAACD,KAAK,CAACA,KAAK,CAAC;MACpBjB,QAAQ,CAAC;QAAEC,IAAI,EAAE,IAAI;QAAEC,OAAO,EAAE,UAAU;QAAEiB,SAAS,EAAE;MAAM,CAAC,CAAC;IACnE;EACJ,CAAC;EAED,MAAMwB,SAAS,GAAGA,CAACzC,OAAO,EAAEiB,SAAS,GAAG,IAAI,KAAK;IAC7CnB,QAAQ,CAAC;MAAEC,IAAI,EAAE,IAAI;MAAEC,OAAO;MAAEiB;IAAU,CAAC,CAAC;IAC5CyB,UAAU,CAAC,MAAM5C,QAAQ,CAACyB,IAAI,KAAK;MAAE,GAAGA,IAAI;MAAExB,IAAI,EAAE;IAAM,CAAC,CAAC,CAAC,EAAE,IAAI,CAAC;EACxE,CAAC;EAED,MAAM4C,OAAO,GAAGtD,SAAS,CAAC0C,MAAM,CAACa,CAAC,IAAIA,CAAC,CAACvC,IAAI,KAAK,KAAK,CAAC;EACvD,MAAMwC,SAAS,GAAGxD,SAAS,CAAC0C,MAAM,CAACa,CAAC,IAAIA,CAAC,CAACvC,IAAI,KAAK,OAAO,CAAC;EAE3D,oBACIyC,OAAA;IAAAC,QAAA,gBACID,OAAA,CAACE,MAAM;MACHvD,cAAc,EAAEA,cAAe;MAC/BwD,cAAc,EAAG7B,CAAC,IAAK1B,iBAAiB,CAAC0B,CAAC,CAACE,MAAM,CAACD,KAAK,CAAE;MACzD6B,UAAU,EAAEhC;IAAY;MAAAiC,QAAA,EAAAC,YAAA;MAAAC,UAAA;MAAAC,YAAA;IAAA,OAC3B,CAAC,eACFR,OAAA;MAAAC,QAAA,EACKxD,OAAO,gBACJuD,OAAA;QAAKS,KAAK,EAAE;UAACC,SAAS,EAAE,QAAQ;UAAEC,OAAO,EAAE;QAAM,CAAE;QAAAV,QAAA,EAAC;MAAM;QAAAI,QAAA,EAAAC,YAAA;QAAAC,UAAA;QAAAC,YAAA;MAAA,OAAK,CAAC,gBAEhER,OAAA,CAAAY,SAAA;QAAAX,QAAA,gBACID,OAAA,CAACa,OAAO;UAACC,KAAK,EAAC,6BAAS;UAACvD,IAAI,EAAC,KAAK;UAACQ,IAAI,EAAE8B,OAAQ;UAACkB,IAAI,EAAC;QAAU;UAAAV,QAAA,EAAAC,YAAA;UAAAC,UAAA;UAAAC,YAAA;QAAA,OAAE,CAAC,eACrER,OAAA,CAACa,OAAO;UAACC,KAAK,EAAC,6BAAS;UAACvD,IAAI,EAAC,OAAO;UAACQ,IAAI,EAAEgC,SAAU;UAACgB,IAAI,EAAC;QAAU;UAAAV,QAAA,EAAAC,YAAA;UAAAC,UAAA;UAAAC,YAAA;QAAA,OAAE,CAAC;MAAA,eAC3E;IACL;MAAAH,QAAA,EAAAC,YAAA;MAAAC,UAAA;MAAAC,YAAA;IAAA,OACC,CAAC,eACPR,OAAA,CAACgB,KAAK;MAACC,MAAM,EAAEpE,WAAY;MAACqE,OAAO,EAAE9C,WAAY;MAACjB,QAAQ,EAAEA,QAAS;MAACgE,QAAQ,EAAE9C,iBAAkB;MAAC+C,QAAQ,EAAE1C;IAAa;MAAA2B,QAAA,EAAAC,YAAA;MAAAC,UAAA;MAAAC,YAAA;IAAA,OAAE,CAAC,eAC7HR,OAAA;MAAKqB,SAAS,EAAE,SAAStE,KAAK,CAACE,IAAI,GAAG,MAAM,GAAG,EAAE,EAAG;MAACwD,KAAK,EAAE;QAAEa,eAAe,EAAEvE,KAAK,CAACoB,SAAS,GAAG,SAAS,GAAG;MAAU,CAAE;MAAA8B,QAAA,EACpHlD,KAAK,CAACG;IAAO;MAAAmD,QAAA,EAAAC,YAAA;MAAAC,UAAA;MAAAC,YAAA;IAAA,OACb,CAAC;EAAA;IAAAH,QAAA,EAAAC,YAAA;IAAAC,UAAA;IAAAC,YAAA;EAAA,OACL,CAAC;AAEZ;AAAClE,EAAA,CAhHQD,GAAG;AAAAkF,EAAA,GAAHlF,GAAG;AAkHZ,eAAeA,GAAG;AAAC,IAAAkF,EAAA;AAAAC,YAAA,CAAAD,EAAA","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}
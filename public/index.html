<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>招聘单位红黑榜 (MongoDB版)</title>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <style>
        /* 保持之前的样式不变 */
        :root {
            --primary-color: #3b82f6;
            --primary-hover: #2563eb;
            --red-list-bg: #fef2f2;
            --red-list-border: #fca5a5;
            --red-text: #dc2626;
            --black-list-bg: #f3f4f6;
            --black-list-border: #d1d5db;
            --black-text: #374151;
            --text-color: #1f2937;
            --bg-color: #f9fafb;
            --white: #ffffff;
            --shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
            --radius: 8px;
        }
        * { box-sizing: border-box; margin: 0; padding: 0; font-family: 'PingFang SC', sans-serif; }
        body { background-color: var(--bg-color); color: var(--text-color); line-height: 1.5; }
        header { background-color: var(--white); box-shadow: var(--shadow); position: sticky; top: 0; z-index: 100; padding: 1rem 2rem; }
        .nav-container { max-width: 1200px; margin: 0 auto; display: flex; justify-content: space-between; align-items: center; }
        .logo { font-size: 1.5rem; font-weight: bold; display: flex; align-items: center; gap: 0.5rem; }
        .nav-controls { display: flex; gap: 1rem; align-items: center; }
        .search-select { padding: 0.5rem 1rem; border: 1px solid #e5e7eb; border-radius: var(--radius); outline: none; }
        .btn-primary { background-color: var(--primary-color); color: var(--white); border: none; padding: 0.5rem 1rem; border-radius: var(--radius); cursor: pointer; display: flex; align-items: center; gap: 0.5rem; }
        .btn-primary:hover { background-color: var(--primary-hover); }
        main { max-width: 1200px; margin: 2rem auto; padding: 0 1rem; }
        .section-title { font-size: 1.5rem; margin-bottom: 1.5rem; padding-bottom: 0.5rem; border-bottom: 2px solid #e5e7eb; display: flex; align-items: center; gap: 0.5rem; }
        .section-title.red { color: var(--red-text); border-color: var(--red-list-border); }
        .section-title.black { color: var(--black-text); border-color: var(--black-list-border); }
        .grid-container { display: grid; grid-template-columns: repeat(auto-fill, minmax(300px, 1fr)); gap: 1.5rem; margin-bottom: 3rem; }
        .card { background: var(--white); border-radius: var(--radius); box-shadow: var(--shadow); padding: 1.5rem; border: 1px solid transparent; position: relative; }
        .card:hover { transform: translateY(-4px); transition: transform 0.2s; }
        .card.red-list { background-color: var(--red-list-bg); border-color: var(--red-list-border); }
        .card.black-list { border: 1px solid #e5e7eb; }
        .card-header { display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 1rem; }
        .company-name { font-size: 1.25rem; font-weight: bold; }
        .company-industry { display: inline-block; font-size: 0.8rem; padding: 0.2rem 0.6rem; background: rgba(0,0,0,0.05); border-radius: 20px; margin-top: 0.25rem; }
        .rating-badge { font-weight: bold; display: flex; align-items: center; gap: 0.3rem; }
        .card-body p { font-size: 0.95rem; color: #4b5563; margin-bottom: 1rem; display: -webkit-box; -webkit-line-clamp: 3; -webkit-box-orient: vertical; overflow: hidden; }
        .tags { display: flex; flex-wrap: wrap; gap: 0.5rem; }
        .tag { font-size: 0.75rem; padding: 0.2rem 0.5rem; border-radius: 4px; background: rgba(0,0,0,0.1); }
        
        .modal-overlay { position: fixed; top: 0; left: 0; right: 0; bottom: 0; background-color: rgba(0, 0, 0, 0.5); display: flex; justify-content: center; align-items: center; z-index: 1000; }
        .modal { background: var(--white); padding: 2rem; border-radius: var(--radius); width: 90%; max-width: 500px; }
        .modal-header { display: flex; justify-content: space-between; margin-bottom: 1.5rem; }
        .close-btn { background: none; border: none; font-size: 1.5rem; cursor: pointer; }
        .form-group { margin-bottom: 1.25rem; }
        .form-label { display: block; margin-bottom: 0.5rem; font-weight: 500; }
        .form-input, .form-textarea, .form-select { width: 100%; padding: 0.75rem; border: 1px solid #d1d5db; border-radius: var(--radius); margin-bottom: 0.5rem; }
        .modal-footer { display: flex; justify-content: flex-end; gap: 1rem; margin-top: 1rem; }
        .btn-secondary { background: #e5e7eb; color: #374151; border: none; padding: 0.6rem 1.2rem; border-radius: var(--radius); cursor: pointer; }
        .toast { position: fixed; bottom: 20px; right: 20px; background: #10b981; color: white; padding: 1rem 1.5rem; border-radius: var(--radius); box-shadow: var(--shadow); transition: transform 0.3s; transform: translateY(100px); }
        .toast.show { transform: translateY(0); }
        .empty-state { grid-column: 1 / -1; text-align: center; padding: 3rem; color: #6b7280; border: 1px dashed #d1d5db; border-radius: var(--radius); background: white; }
        @media (max-width: 640px) { .nav-container { flex-direction: column; gap: 1rem; } .nav-controls { width: 100%; justify-content: space-between; } .search-select { flex: 1; } }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect } = React;

        // 后端 API 地址
        const API_URL = 'https://crdb-backend.zeabur.app/api/companies';

        const allIndustries = ["全部", "互联网", "金融", "物流", "教育", "设计", "制造", "其他"];

        // 主应用组件
        function App() {
            const [companies, setCompanies] = useState([]);
            const [loading, setLoading] = useState(true);
            const [filterIndustry, setFilterIndustry] = useState("全部");
            
            // 新增：榜单类型状态 ('all' | 'red' | 'black')
            const [viewType, setViewType] = useState("all");

            const [isModalOpen, setIsModalOpen] = useState(false);
            const [toast, setToast] = useState({ show: false, message: '' });

            const [formData, setFormData] = useState({
                name: '', industry: '互联网', type: 'red', rating: 5, tags: '', comment: ''
            });

            // 获取数据逻辑不变...
            const fetchCompanies = async () => {
                try {
                    setLoading(true);
                    const url = filterIndustry === "全部" 
                        ? API_URL 
                        : `${API_URL}?industry=${filterIndustry}`;
                    
                    const response = await fetch(url);
                    const data = await response.json();
                    setCompanies(data);
                } catch (error) {
                    console.error("获取数据失败:", error);
                    setToast({ show: true, message: "连接服务器失败", isSuccess: false });
                } finally {
                    setLoading(false);
                }
            };

            useEffect(() => {
                fetchCompanies();
            }, [filterIndustry]);

            // 其他处理函数保持不变...
            const toggleModal = () => { /* ... */ };
            const handleInputChange = (e) => { /* ... */ };
            const handleSubmit = async (e) => { /* ... */ };
            const showToast = (message, isSuccess = true) => { /* ... */ };

            // 数据分离逻辑
            const redList = companies.filter(c => c.type === 'red');
            const blackList = companies.filter(c => c.type === 'black');

            return (
                <div>
                    {/* 传入新的 props: viewType 和 onViewTypeChange */}
                    <Header 
                        filterIndustry={filterIndustry} 
                        onFilterChange={(e) => setFilterIndustry(e.target.value)}
                        viewType={viewType}
                        onViewTypeChange={(e) => setViewType(e.target.value)}
                        onAddClick={toggleModal}
                    />
                    
                    <main>
                        {loading ? (
                            <div style={{textAlign: 'center', padding: '2rem'}}>加载中...</div>
                        ) : (
                            <>
                                {/* 根据 viewType 条件渲染：如果选 'all' 或 'red'，才显示红榜 */}
                                {(viewType === 'all' || viewType === 'red') && (
                                    <Section title="红榜 (推荐)" type="red" data={redList} icon="fa-heart" />
                                )}

                                {/* 根据 viewType 条件渲染：如果选 'all' 或 'black'，才显示黑榜 */}
                                {(viewType === 'all' || viewType === 'black') && (
                                    <Section title="黑榜 (避雷)" type="black" data={blackList} icon="fa-skull" />
                                )}
                            </>
                        )}
                    </main>
                    
                    {/* Modal 和 Toast 保持不变 */}
                    <Modal isOpen={isModalOpen} onClose={toggleModal} formData={formData} onChange={handleInputChange} onSubmit={handleSubmit} />
                    <div className={`toast ${toast.show ? 'show' : ''}`} style={{ backgroundColor: toast.isSuccess ? '#10b981' : '#ef4444' }}>
                        {toast.message}
                    </div>
                </div>
            );
        }

        // 其他 UI 组件保持不变 (Header, Section, Card, Modal)
       function Header({ filterIndustry, onFilterChange, viewType, onViewTypeChange, onAddClick }) {
            return (
                <header>
                    <div className="nav-container">
                        <div className="logo">
                            <i className="fas fa-balance-scale" style={{color:'#3b82f6'}}></i> 
                            招聘红黑榜
                        </div>
                        <div className="nav-controls">
                            {/* 原有的行业筛选 */}
                            <select className="search-select" value={filterIndustry} onChange={onFilterChange}>
                                <option value="全部">所有行业</option>
                                <option value="互联网">互联网</option>
                                <option value="金融">金融</option>
                                <option value="物流">物流</option>
                                <option value="教育">教育</option>
                                <option value="设计">设计</option>
                                <option value="制造">制造</option>
                                <option value="其他">其他</option>
                            </select>

                            {/* 新增：榜单类型筛选 */}
                            <select 
                                className="search-select" 
                                value={viewType} 
                                onChange={onViewTypeChange}
                                style={{ marginLeft: '0.5rem' }}
                            >
                                <option value="all">全部榜单</option>
                                <option value="red">仅看红榜</option>
                                <option value="black">仅看黑榜</option>
                            </select>

                            <button className="btn-primary" onClick={onAddClick}>
                                <i className="fas fa-plus"></i> 添加公司
                            </button>
                        </div>
                    </div>
                </header>
            );
        }

        function Section({ title, type, data, icon }) {
            return (
                <section>
                    <h2 className={`section-title ${type}`}>
                        <i className={`fas ${icon}`}></i> {title} <span style={{fontSize:'1rem', opacity:0.7}}>({data.length})</span>
                    </h2>
                    <div className="grid-container">
                        {data.length === 0 ? <div className="empty-state">暂无数据</div> : 
                        data.map(c => <CompanyCard key={c._id} company={c} type={type} />)}
                    </div>
                </section>
            );
        }

        function CompanyCard({ company, type }) {
            return (
                <div className={`card ${type}-list`}>
                    <div className="card-header">
                        <div>
                            <div className="company-name">{company.name}</div>
                            <span className="company-industry">{company.industry}</span>
                        </div>
                        <div className="rating-badge" style={{color: type==='red'?'var(--red-text)':'var(--black-text)'}}>
                            {type === 'red' ? <i className="fas fa-star"></i> : <i className="fas fa-thumbs-down"></i>}
                            {company.rating}
                        </div>
                    </div>
                    <div className="card-body">
                        <p>{company.comment}</p>
                    </div>
                    <div className="tags">
                        {company.tags && company.tags.map((tag, i) => <span key={i} className="tag">{tag}</span>)}
                    </div>
                </div>
            );
        }

        function Modal({ isOpen, onClose, formData, onChange, onSubmit }) {
            if (!isOpen) return null;
            return (
                <div className="modal-overlay" onClick={onClose}>
                    <div className="modal" onClick={e => e.stopPropagation()}>
                        <div className="modal-header">
                            <h3>添加新公司评价</h3>
                            <button className="close-btn" onClick={onClose}>&times;</button>
                        </div>
                        <form onSubmit={onSubmit}>
                            <div className="form-group">
                                <label className="form-label">公司名称</label>
                                <input type="text" name="name" className="form-input" required value={formData.name} onChange={onChange} />
                            </div>
                            <div style={{display:'flex', gap:'1rem'}}>
                                <div style={{flex:1}}>
                                    <label className="form-label">行业</label>
                                    <select name="industry" className="form-select" value={formData.industry} onChange={onChange}>
                                        {allIndustries.filter(i => i !== '全部').map(i => <option key={i} value={i}>{i}</option>)}
                                    </select>
                                </div>
                                <div style={{flex:1}}>
                                    <label className="form-label">类型</label>
                                    <select name="type" className="form-select" value={formData.type} onChange={onChange}>
                                        <option value="red">红榜</option>
                                        <option value="black">黑榜</option>
                                    </select>
                                </div>
                            </div>
                            <div className="form-group">
                                <label className="form-label">评分 (0-5)</label>
                                <input type="number" name="rating" className="form-input" min="0" max="5" step="0.1" value={formData.rating} onChange={onChange} />
                            </div>
                            <div className="form-group">
                                <label className="form-label">标签 (逗号分隔)</label>
                                <input type="text" name="tags" className="form-input" placeholder="双休, 加班多" value={formData.tags} onChange={onChange} />
                            </div>
                            <div className="form-group">
                                <label className="form-label">评价详情</label>
                                <textarea name="comment" className="form-textarea" required value={formData.comment} onChange={onChange}></textarea>
                            </div>
                            <div className="modal-footer">
                                <button type="button" className="btn-secondary" onClick={onClose}>取消</button>
                                <button type="submit" className="btn-primary">提交</button>
                            </div>
                        </form>
                    </div>
                </div>
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>